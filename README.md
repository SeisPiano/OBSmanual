# 被动源OBS数据处理手册

吴越楚

[南方科技大学海底地震仪实验室](https://obslab.sustech.edu.cn) SUSTech OBS Lab

<12131066@mail.sustech.edu.cn>

本手册包含了被动源OBS数据的基本处理，特别适合初学者😊😊

## 视频教程

**第三届佘山学堂｜地震观测新技术的应用与实践** [被动源OBS数据处理：程序和实践](https://www.koushare.com/live/details/12340?vid=36395)

**第二届OBS探测技术与应用青年学术论坛** [被动源OBS数据处理](https://www.koushare.com/live/details/39370?vid=157760)

## 1 获取数据

### 1.1 公开数据

下载公开数据，首先要获取台站元数据，若要下载地震事件数据，还要获取地震事件相关信息

#### 1.1.1 获取台站元数据


- 在[IRIS-MDA](https://ds.iris.edu/mda/)或[FDSN](https://www.fdsn.org/)上找到要下载数据的台网名称及其起止时间，通过`get_stations`获取台站元数据
- 若要获取部分台站元数据，则在`get_stations`指定台站名称
- 若要获取该台网全部台站元数据，则在`get_stations`不指定台站名称
- 若要获取多个台站或通道，使用`,`作为分隔符，例如`B01,B02`
- 台站或通道支持使用通配符`?`和`*`

#### 1.1.2 获取地震信息

通过`get_events`获取地震事件信息

#### 1.1.3 计算震中距及方位角、反方位角

这几个参数在SAC中都有其特定的头文件名，这里的`distance_in_degree`即SAC中的`gcarc`,这里的`distance_in_km`即SAC中的`dist`

- gcarc：全称great circle arc，即震中到台站的大圆弧的长度，单位为 °
- dist：震中到台站的距离，单位为 km
- az：方位角，震中到台站的连线与地理北向的夹角，单位为 °
- baz：反方位角，台站到震中的连线与地理北向的夹角，单位为 °

#### 1.1.4 计算震相理论到时

基于一维地球模型计算指定震相的理论到时，同时根据瑞利波速度计算瑞利面波的大致时间窗

#### 1.1.5 下载地震数据

通过`get_waveforms`下载地震波形数据，下载的数据会成为一个 Stream 对象  

Stream 对象类似一个包含多个 Trace 对象（无间隙连续时间序列和相关的对象元数据）的列表

#### 1.1.6 绘制下载的波形

#### 1.1.7 自动下载地震数据程序包`DownloadSeisData`

[DownloadSeisData](https://github.com/SeisPiano/DownloadSeisData)是一款自动下载地震数据和数据预处理的软件包，目前提供了Python和Shell版本。

`DownloadSeisData`可以自动下载台站元数据、每日波形数据和仪器响应文件。此外，它还可以根据台站元数据自动下载地震目录和地震事件波形数据。所有波形数据均以SAC格式保存。由于下载了相应的仪器响应文件，可以将波形的单位转换为位移、速度、加速度（地震计）或压力（压力计）。同时， `DownloadSeisData`还将台站信息和事件信息等相关参数保存在SAC头段变量中以供后续使用。

## 1.2 本地数据

###  1.2.1 读取本地数据
通过`read`模块读取本地数据，`obspy`的`read`函数几乎支持所有的地震数据格式（如 SAC、MiniSEED 等），读取的数据会成为一个 Stream 对象，与下载的公开数据一致

### 1.2.2 截取地震事件数据

通过`trim`截取指定时间范围的数据

## 2 数据预处理

###  2.1 去除仪器响应

地震仪观测到的地面运动记录可以表示为：
$$
u(t) = s(t) * g(t) * i(t)
$$
其中$s(t)$代表震源项，$g(t)$代表路径效应，$i(t)$代表仪器响应，$*$代表卷积  

为了得到台站绝对振幅值，反映真实的地面位移（或速度、加速度），需要去除仪器响应

#### 2.1.1 公开数据

对于公开数据，只需在下载波形数据时指定`attach_response=True`，后续即可非常方便的去除仪器响应

#### 2.1.2 本地数据
`SUSTech OBS Lab` 自主研发的磐鲲OBS仪器响应文件如下：  

- 仪器响应文件仅作展示，无需运行

需要注意：
- 磐鲲原始仪器响应文件有2个“零”零点，此时去除仪器响应至速度 (m/s)
- 若增加1个“零”零点，即有3个“零”零点，此时去除仪器响应至位移 (m)
- 若减少1个“零”零点，即有1个“零”零点，此时去除仪器响应至加速度 (m/s^2)

### 2.2 去均值、去线性趋势、波形尖灭

- 去均值：去除波形数据的平均值。
- 去线性趋势：将数据拟合成一条直线，然后从数据中减去该直线所表征的线性趋势。
- 波形尖灭：将波形数据的首尾两端由其原始值不断光滑地减小到0。

### 2.3 滤波

- 带通滤波：只保留特定频段的波形，同时屏蔽其他频段的波形。

### 2.4 重采样

### 2.5 将信息写入SAC头文件

## 3 绘制概率功率谱密度（PPSD）

PPSD（probability power spectral density） 是一种常用的分析地震噪声的方法，用于研究地震仪记录的背景噪声的频率分布和时间变化。它通过统计噪声的功率谱密度（power spectral density, PSD）在不同时间段的概率分布来揭示地震仪记录数据中噪声水平的动态特性。

### 3.1 公开数据

### 3.2 本地数据

## 4 确定水平方位角

陆地地震仪在布设时，需要将其N分量指向地理北向。然而海底地震仪（ocean bottom seismograph, OBS）一般采用自由沉入海底的布设方式，其N分量的指向是随机的，因此需要通过数据分析的方法确定OBS的水平方位角。

这里我们使用 Stachnik et al. (2012)的方法来确定OBS的水平方位角，该方法是基于瑞利波（Rayleigh wave）的极化实现的。瑞利波在垂向（Z）和径向（R）上存在90°的相位差，因此我们可以通过旋转水平分量与垂直分量的希尔伯特变换（Z Hilbert）求相关性，从而确定N分量到径向的旋转角（$θ$），再由径向（$baz$）和旋转的角度（$θ$）确定N分量的方位（$X$），即OBS的水平方位角：
$$
X = baz - θ
$$

最后，通过台站布设期间记录的多个地震事件获得水平方位角的统计结果，最终确定OBS的水平方位角。

### 4.1 Matlab程序包`orient`

[orient](https://github.com/SeisPiano/orient)程序包可以自动计算地震面波的信噪比并确定OBS的水平方位角，同时也可以手动挑选地震面波再确定OBS的水平方位角。

### 4.2 Python程序包`OrientPy`

`OrientPy`是一个工具箱，通过自动（和手动）处理地震数据来帮助确定地震计的方向。这些方法对OBS台站特别有用，但也适用于宽频带陆地台站或短周期OBS（取决于所选的方法）。该代码使用`StDb`包查询和构建台站数据库，可以通过命令行脚本使用。目前，该工具箱包括以下方法：

- DL（Doran and Laske, 2017）：基于不同频率范围内的瑞利波极化以及两种基阶模态瑞利波轨道。

- BNG（Braunmiller, Nabelek and Ghods, 2020）：基于区域地震和远震的P波极化。

每种方法都可以独立用于确定台站的水平方位角，即地震分量1（或N）的方位角。

## 5 去除倾斜噪声和屈服噪声

### 5.1 Matlab程序包`ATaCR`

自动去除倾斜和屈服噪声（Automated Tilt and Compliance Removal）（[ATaCR](https://github.com/helenjanisz/ATaCR)，读作attacker）程序包，用于描述和去除海底地震仪（ocean bottom seismograph, OBS）数据中的倾斜噪声（tilt noise）和屈服噪声（compliance noise）。根据Crawford and Webb (2000)以及Bell et al. (2015)的方法进行倾斜和屈服噪声校正。更多详细信息，请参阅[ATaCR手册](https://github.com/helenjanisz/ATaCR/blob/master/ATaCR_Manual.pdf)。


### 5.2 Pthon程序包`OBStools`

ATaCR的Python版，该代码使用`StDb`包查询和构建台站数据库，可以通过命令行脚本使用。

## 6 去除谐波噪声

谐波噪声（harmonic noise）是一种普遍存在于 OBS 数据中的噪声，这种噪声没有特定的来源，但其特点与地震信号有明显不同。地震信号类似于冲击信号，是宽带瞬态信号。而谐波噪声相比地震信号更为窄带且长时间存在。

[NoiseCut](https://github.com/ZahraZali/NoiseCut)程序包通过谐波冲击分离（harmonic–percussive separation, HPS ）算法去除 OBS 数据中的谐波噪声，以分离 OBS 数据中的“谐波”（长期窄带信号）和“冲击”（宽带瞬态）分量，旨在降低噪声水平并得到更清晰的宽带地震波形。

## 7 使用pyGMT绘制台站位置图
